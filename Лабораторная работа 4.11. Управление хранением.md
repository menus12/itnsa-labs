## Лабораторная работа 4.11. Управление хранением

### Описание сценария

Учетная запись хранения может быть использована не только для хранения BLOB-объектов, но а также для хранения файлов с прямым доступом из операционной системы через сетевую папку.

В данном сценарии системный администратор разворачивает учетную запись хранения, чтобы подключить сетевую папку для прямого доступа из операционной системы.

### Задачи лабораторной работы

- Создать виртуальную машину
- Создать учетную запись хранения
- Создать общую папку в учетной записи хранения и подключить ее в качестве сетевого хранилища файлов

### Создание виртуальной машины

1. Войдите на портал Azure по адресу **portal.azure.com** под вашей учетной записью.
2. Создайте группу ресурсов или используйте группу ресурсов, выделенную для вашей учетной записи.
3. Создайте виртуальную машину согласно следующим основным параметрам:

| **Параметр** | **Значение** |
| --- | --- |
| Подписка | Использовать предоставленное по умолчанию |
| Группа ресурсов | Использовать предоставленное по умолчанию |
| Имя виртуальной машины | SimpleWinVM |
| Регион | (US) Восточный регион США |
| Параметры доступности | Избыточность параметров инфраструктуры не требуется |
| Образ | Windows Server 2019 Datacenter, поколение 1 |
| Размер | Standard D2s v3 |
| Имя пользователя | azureuser |
| Пароль (внимательно следите за правильностью ввода!) | Pa$$w0rd1234 |
| Общедоступные входящие порты | Разрешить выбранные порты |
| Выбрать входящие порты | RDP (3389) |

4. На вкладке «Диски» выберите тип ОС диска SSD (цен. Категория «Стандартный»).
5. Нажмите «**Просмотр и создание**» (Review + Create) в нижней части страницы. Ознакомьтесь с параметрами и нажмите «**Создать**» (Create). Создание виртуальной машины займет несколько минут, информация об окончании процесса появится в верхней панели уведомлений.

### Создание учетной записи хранения

1. Создайте учетную запись хранения со со следующими параметрами:

| **Параметр** | **Значение** |
| --- | --- |
| Подписка | Использовать предоставленное по умолчанию |
| Группа ресурсов | Использовать предоставленное по умолчанию |
| Имя учетной записи хранения | storageaccountxxxxx (замените **xxxxx** таким образом, чтобы имя учетной записи было уникальным) |
| Расположение | (US) Восточный регион США |
| Производительность | Стандартный |
| Избыточность | Локально избыточное хранилище (LRS) |

2. Оставьте остальные параметры по умолчанию и нажмите «**Проверка и создание**». Ознакомьтесь с параметрами и нажмите «**Создать**». Дождитесь уведомления об успешном создании в панели уведомлений.
3. Перейдите к созданной учетной записи хранения и в левом меню в разделе «**Хранилище данных**» выберите «**Общие файловые ресурсы**». В верхней панели нажмите «**+Общая папка**». В появившейся правой панели задайте имя папки **sharedstorage** и нажмите «**Создать**».

![](/assets/pics/4.11.1.png "Рис. 4.11.1. Добавление общей папки")

4. Нажмите на созданную папку в основном окне. В открывшемся окне в верхней панели управления нажмите «**Отправить**». В правой панели нажмите на выбор файла, в появившемся диалоговом окне выберите любой локальный файл и нажмите «**Отправить**». Убедитесь, что выбранный файл появился в основном окне.

### Подключение общей папки к виртуальной машине

1. В верхней панели нажмите «**Подключение**». В правой части появится панель с параметрами подключения для различных операционных систем. Убедитесь в том, что выбранная буква диска «**Z**» и что в качестве метода проверки подлинности выбран «**Ключ учетной записи хранения**». Ниже расположен блок команд для подключения общей папки. Скопируйте весь текст в данном блоке в буфер обмена.
2. Подключитесь к виртуальной машине по RDP. Запустите терминал **PowerShell** от имени администратора.
3. Вставьте в терминал скопированный блок команд и нажмите ввод. Первая команда проверяет доступность подключения по порту TCP 445 (SMB) и в случае успеха пытается подключить сетевой диск.
4. После успешного завершения команды откройте проводник внутри виртуальной машины и убедитесь в том, что подкачен сетевой диск «**Z:**». Откройте его и убедитесь в том, что в корне диска присутствует файл, который вы загружали ранее через портал Azure.
5. В терминале PowerShell создайте в корне диска пустой текстовый файл с помощью команды **New-Item -Type File -Path &#39;Z:\testfile.txt&#39;**.
6. Вернитесь созданной общей папке на портале Azure, в верхней панели нажмите «**Обновить**» и убедитесь в том, что созданный с помощью PowerShell файл отображается в основном окне.