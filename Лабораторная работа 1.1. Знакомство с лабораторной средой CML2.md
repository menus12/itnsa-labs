# Раздел 1. Маршрутизация
## Лабораторная работа 1.1. Знакомство с лабораторной средой CML2
Cisco Modeling Labs 2.0 представляет собой платформу моделирования конвергентных информационных инфраструктур, а также является более совершенной версией предшествующей платформы Cisco Virtual Internet Routing Lab (VIRL). 

По сравнению с Cisco VIRL, данная платформа по-прежнему использует KVM в качестве гипервизора для запуска образов виртуальных машин, однако, если VIRL был полностью спроектирован для работы поверх решения OpenStack, движок CML2 был переписан «с нуля», что позволяет сэкономить значительный объем ресурсов при запуске лабораторных сценариев моделирования. 

CML2 построен на основе RESTful API-интерфейсов, разработанных с учетом требований безопасности и автоматизации. Данные интерфейсы можно использовать для создания лабораторных сценариев и программного управления всем жизненным циклом моделирования. Все взаимодействие с платформой основано на принципе «API-fist», чтобы обеспечить единообразие детализированных операций через API, в том числе:
- HTML5 интерфейс пользователя
- дополнительные утилиты, такие как Breakout Tool
- SDK-библиотека для языка программирования Python
Кроме возможности моделировать инфраструктуру для целей изучения технологий и подготовки к профессиональным сертификациям, CML2 может служить инструментом рабочей экосистемы разработки и инфраструктурных операций, позволяя тестировать и проверять изменения конфигурации виртуальных устройств в автоматизированном рабочем процессе

### Доступ к пользовательскому интерфейсу HTML5

Для начала работы с платформой откройте веб-браузер и перейдите по адресу **<https://<адрес-или-имя-вашего-CML-сервера>**. 

При возникновении сообщения об ошибке безопасности (Рис. 1) нажмите кнопку «Принять риск и перейти на сайт». Для того чтобы исключить данное сообщение при обращении к серверу, используйте действительный сертификат безопасности (например, воспользовавшись сервисом [Let’s encrypt](https://letsencrypt.org/)).

Введите учетные данные (настроенные при установке или выданные вам администратором вашего CML сервера) как показано на Рис. 2. 
Основными элементами для работы с лабораторными работами являются страницы **Dashboard** (стартовая панель управления) и **Workbench** (интерфейс редактирования сценариев). 

Стартовая панель управления обеспечивает доступ ко всем созданным лабораторным работам и обзор состояния каждой из них, а также текущий статус контроллера (загрузку процессора, оперативной памяти, дискового пространства), как показано на Рис. 3.

По умолчанию список лабораторных работ отображается в виде набора плиток. Если вы еще не создали лабораторный сценарий, плитки отображаться не будут. При нажатии по плитке данный сценарий откроется в интерфейсе редактирования.

![](/assets/pics/1.1.1.png "Рис. 1.1.1. Предупреждение, в случае использования сертификата по умолчанию")
![](/assets/pics/1.1.2.png "Рис. 1.1.2. Форма авторизации")
![](/assets/pics/1.1.3.png "Рис. 1.1.3. Стартовая панель управления")

Вверху страницы панели управления находится строка меню со следующими элементами:
- **Search** — позволяет отфильтровать отображаемые лабораторные сценарии
- **Show list** — позволяет изменить вид отображения, можно переключаться между отображением сценариев в виде плиток или в виде списка
- **Show all** — позволяет показать или скрыть лабораторные сценарии, к которым был предоставлен доступ другими пользователями
- **Add** — позволяет создать новый лабораторный сценарий
- **Import** — открывает диалог импорта существующего сценария

### Создание и импорт лабораторных сценариев

Для того чтобы импортировать существующий лабораторный сценарий, в панели управления необходимо нажать на кнопку **Import** , после чего откроется диалог импорта, как показано на Рис. 4. В данном диалоге необходимо нажать на поле **File(s) to import** и в диалоговом окне выбрать файл в формате YAML, после чего нажать кнопку **Import**.

При успешном импорте появится окно статуса с зелёным индикатором. Для перехода к импортированному сценарию необходимо нажать кнопку **Go to lab**.

Для создания нового сценария, в панели управления необходимо нажать на кнопку **Add** , после чего откроется интерфейс редактирования сценариев, как показано на Рис. 5.

При создании или импорте сценария, ему будет присвоен уникальный идентификатор, который отображается в строке адреса браузера (/labs/<идентификатор>), а также в заголовке вкладки браузера. Имя лабораторной работы по умолчанию можно изменить на любое удобное (при импорте, будет использовано имя YAML-файла).

![](/assets/pics/1.1.4.png "Рис. 1.1.4. Диалог импорта сценария")
![](/assets/pics/1.1.5.png "Рис. 1.1.5. Страница редактирования сценария")

### Добавление виртуальных машин и виртуальных соединений

Справа отобразится палитра образов виртуальных машин (ВМ), зарегистрированных на контроллере CML. При наведении на элемент палитры (пиктограмму) отобразится его описание. Добавление виртуальной машины в сценарий производится путем перетаскивания элемента палитры на рабочую область интерфейса.

После добавления виртуальных машин на рабочую область, при наведении на пиктограмму виртуальной машины появляется меню, в котором могут присутствовать следующие действия:

- запуск ВМ (если ВМ не запущена)
- остановки ВМ (если ВМ запущена)
- создания виртуального соединения между ВМ
- перехода в интерфейс командной строки (если ВМ запущена)

Для создания соединения между виртуальными машинами, необходимо навести курсор на одну из виртуальных машин и в появившемся круговом меню нажать на верхнюю пиктограмму цепочки и, удерживая курсор нажатым, довести соединение до пиктограммы второй виртуальной машины, как показано на Рис. 6. После чего откроется диалоговое окно выбора интерфейсов для соединения на первой и на второй виртуальной машине, как показано на Рис. 7. После нажатия на кнопку **Create link** устройства будут соединены как показано на Рис. 8.

По умолчанию в рабочей области на соединениях между устройствами будут отображаться названия интерфейсов. Чтобы отключить отображение названий, можно нажать на букву **А** в левой верхней части рабочей области (**Toggle Link Labels**).

![](/assets/pics/1.1.6.png "Рис. 1.1.6. Создание виртуального соединения между виртуальными машинами")
![](/assets/pics/1.1.7.png "Рис. 1.1.7. Диалог выбора интерфейсов")
![](/assets/pics/1.1.8.png "Рис. 1.1.8. Отображение интерфейсов на виртуальном соединении")

Для запуска сценария можно запустить каждую виртуальную машину по отдельности путём наведения на каждую пиктограмму и нажатия на левый элемент кругового меню, или в разделе **Simulate** нажать на кнопку **Start lab**, для запуска всех виртуальных машин одновременно. При запуске, на пиктограмме каждой виртуальной машины появится значок обозначающий, что виртуальная машина находится в состоянии загрузки. После загрузки значок смениться на галочку. При остановке виртуальной машины без очистки ее состояния (wipe), будет отображаться значок крестика.

### Интерфейс страницы редактирования сценариев

В нижней части интерфейса расположены элементы управления сценарием:

- **Lab info** — позволяет ввести краткое описание лабораторного сценария, отображает количество виртуальных машин, соединений и интерфейсов

![](/assets/pics/1.1.9.png "Рис. 1.1.9. Базовая информация о сценарии")

- **Permissions** — позволяет предоставить доступ на чтение или изменение данного сценария другим пользователям контроллера

![](/assets/pics/1.1.10.png "Рис. 1.1.10. Управление доступом")

- **Simulate** — позволяет запустить, остановить или очистить все виртуальные машины в лабораторном сценарии, а также скачать данный сценарий в виде YAML-файла

![](/assets/pics/1.1.11.png "Рис. 1.1.11. Управление сценарием")

- **Nodes** — позволяет производить запуск, остановку, очистку конфигурации, экспорт конфигурации и удаление одной или нескольких виртуальных машин. В данной панели также отображается текущий статус загрузки, время после запуска и загрузка процессора для каждой виртуальной машины

![](/assets/pics/1.1.12.png "Рис. 1.1.12. Управление виртуальными машинами")

- **Design** — позволяет сгенерировать стартовые конфигурации для виртуальных машин, эмулирующих сетевые устройства

![](/assets/pics/1.1.13.png "Рис. 1.1.13. Генерация начальных конфигураций")

- **Logs** — Позволяет просматривать события сценария моделирования

![](/assets/pics/1.1.14.png "Рис. 1.1.14. Просмотр событий")

- **Lab notes** — Позволяет редактировать описание и заметки по данному сценарию в формате Markdown

![](/assets/pics/1.1.15.png "Рис. 1.1.15. Редактирование заметок")

### Управление виртуальными машинами

При нажатии на пиктограмму виртуальной машины на рабочей области нижняя часть интерфейса смениться на панель управления виртуальной машиной сценария, в которой присутствуют следующие вкладки:

- **Node info** — содержит базовую информацию, позволяет клонировать или удалить виртуальную машину, настроить отображаемое имя, а также добавить теги

![](/assets/pics/1.1.16.png "Рис. 1.1.16. Информация о виртуальной машине")

- **Simulate** — содержит управляющие элементы для запуска, остановки, очистки конфигурации, а также управления параметрами виртуализации, такими как выбор образа, управление памятью и ограничение по загрузке процессора

![](/assets/pics/1.1.17.png "Рис. 1.1.17. Параметры виртуализации")

- **Connectivity** — содержит средства просмотра текущих подключений к другим виртуальным машинам с указанием интерфейсов в режиме «точка-точка»

![](/assets/pics/1.1.18.png "Рис. 1.1.18. Информация о виртуальных соединениях")

- **Console** — среда терминального эмулятора для доступа к интерфейсу командной строки через виртуальный последовательный порт

![](/assets/pics/1.1.19.png "Рис. 1.1.19. Последовательная консоль")

- **VNC** — терминал доступа по протоколу VNC (для виртуальных машин, с графическим интерфейсом пользователя)
- **Edit config** — элемент управления стартовой конфигурацией устройства в котором можно редактировать стартовую конфигурацию (только когда устройство в чистом состоянии), а также импортировать текущую конфигурацию с запущенного устройства

![](/assets/pics/1.1.20.png "Рис. 1.1.20. Окно редактирования конфигурации")

- **Interfaces** — элемент управления интерфейсами с возможностью добавления и удаления (только в чистом состоянии устройства)

![](/assets/pics/1.1.21.png "Рис. 1.1.21. Управление интерфейсами устройства")

### Управление виртуальными соединениями

При нажатии на виртуальное соединение на рабочей области нижняя часть интерфейса смениться на панель управления виртуальным соединением, в которой присутствуют следующие вкладки:

- **Link info** — позволяет удалить соединение, а также отображает информацию виртуальных машинах и их интерфейсах, соединенных между собой

![](/assets/pics/1.1.22.png "Рис. 1.1.22. Информация о виртуальном соединении")

- **Simulate** — позволяет включать и отключать соединение, симулировать различные состояния соединения с настройками параметров пропускной способности, задержки, вариации времени между доставкой пакетов и количество теряемых пакетов, а также позволяет просматривать статистику об интерфейсах, с указанием количества трафика (в байтах), прошедшего через данные интерфейсы

![](/assets/pics/1.1.23.png "Рис. 1.1.23. Симуляция состояний соединения")

- **Packet capture** — позволяет запускать перехват пакетов, проходящих по данному виртуальному соединению с возможностью
  - просмотра деталей каждого перехваченного пакета в данной панели,
  - выгрузки сессии перехваченного трафика в формате PCAP
  - указания параметров перехвата трафика, таких как:
    - максимальное количество перехватываемых пакетов
    - максимальное количество времени, которое будет осуществляться перехват
    - фильтр перехватываемого трафика в формате BerkeleyPacketFilter

![](/assets/pics/1.1.24.png "Рис. 1.1.24. Перехват пакетов на виртуальном соединении")
