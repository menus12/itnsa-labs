## Лабораторная работа 1.4. Протокол динамической маршрутизации OSPF

### Описание сценария

Согласно сценарию, небольшая компания планирует открыть еще несколько подразделений, поэтому сетевому администратору было поручено обеспечить масштабируемость сети. В данной лабораторной работе вы ознакомитесь с еще одним протоколом динамической маршрутизации, с помощью которого решите поставленную цель, а именно OSPF (Open Shortest Path First) – протокол динамической маршрутизации, основанный на технологии отслеживания состояния канала.

### Задачи лабораторной работы

- Настроить базовые параметры протокола динамической маршрутизации OSPF
- Обеспечить связность между всеми клиентскими машинами

### Описание топологии

Топология состоит из трех клиентских машин PC-A, PC-B, PC-C и трех маршрутизатора R1, R2, и R3.

![](/assets/pics/1.4.1.png "Рис. 1.4.1. Топология")

| Устройство | Интерфейс | IP-адрес | Маска подсети | Шлюз по умолчанию |
| --- | --- | --- | --- | --- |
| R1 | G0/0 | 192.168.1.1 | 255.255.255.0 | - |
| | G0/1 | 10.1.2.1 | 255.255.255.252 | - |
| | G0/2 | 10.1.3.1 | 255.255.255.252 | - |
| R2 | G0/0 | 192.168.2.2 | 255.255.255.0 | - |
| | G0/1 | 10.1.2.2 | 255.255.255.252 | - |
| | G0/2 | 10.2.3.1 | 255.255.255.252 | - |
| R3 | G0/0 | 192.168.3.3 | 255.255.255.0 | - |
| | G0/1 | 10.1.3.2 | 255.255.255.252 | - |
| | G0/2 | 10.2.3.2 | 255.255.255.252 | - |
| PC-A | NIC | 192.168.1.11 | 255.255.255.0 | 192.168.1.1 |
| PC-B | NIC | 192.168.2.11 | 255.255.255.0 | 192.168.2.2 |
| PC-C | NIC | 192.168.3.11 | 255.255.255.0 | 192.168.3.3 |

### Начальное состояние и базовые настройки устройств

- Интерфейсы всех устройств настроены в соответствии с таблицей адресации

### Проверка связности

1. Откройте консоль PC-A (учетная запись cisco\cisco) и выполните проверку доступности PC-B и PC-C с помощью команды **ping.**
2. PC-A не достигло ни одной из других клиентских машин, потому что приватные сети 192.168.2.0/24 и 192.168.3.0/24 отсутствуют в таблице маршрутизации R1. Убедитесь в этом при помощи команды, выполнив команды **show ip route 192.168.2.0** и **show ip route 192.168.3.0** на маршрутизаторе R1.

```
PC-A:~$ ping -c 5 192.168.2.11
PING 192.168.2.11 (192.168.2.11): 56 data bytes
--- 192.168.2.11 ping statistics ---
5 packets transmitted, 0 packets received, 100% packet loss

PC-A:~$ ping -c 5 192.168.3.11
PING 192.168.3.11 (192.168.3.11): 56 data bytes
--- 192.168.3.11 ping statistics ---
5 packets transmitted, 0 packets received, 100% packet loss

R1#show ip route 192.168.2.0
% Network not in table

R1#show ip route 192.168.3.0
% Network not in table
```

3. Аналогично убедитесь в отсутствии связности между PC-B и PC-C.

### Настройка динамической маршрутизации

1. Создайте процесс OSPF с идентификатором процесса 100 на маршрутизаторе R1 при помощи команды **router  ospf  100**.
2. На маршрутизаторе R1 включите OSPF на интерфейсах G0/1 и G0/2, которые будут принадлежать магистральной зоне, при помощи команд **network 10.1.2.0 0.0.0.3  area  0** и **network 10.1.3.0 0.0.0.3 area 0**.

**Примечание**
---
Идентификатор процесса является локально значимым, таким образом, он может не соответствовать идентификаторам процессов OSPF на других маршрутизаторах OSPF, чтобы они могли установить соседство.

Параметры команды **network** включают в себя непосредственно присоединенную сеть к маршрутизатору, обратную (wildcard) маску и идентификатор зоны, в которой будет работать интерфейс маршрутизатора.

Магистральная (backbone) зона (она же нулевая) формирует ядро сети OSPF. Магистральная зона ответственна за распространение маршрутизирующей информации между немагистральными зонами. Все обновления OSPF, которые передаются между различными зонами, должны проходить через магистральную зону.
---

3. На маршрутизаторе R1 включите OSPF на интерфейсе G0/0, который будет принадлежать зоне 1, при помощи команды **network 192.168.1.0 0.0.0.255 area 1**.

```
R1(config)#router ospf 100
R1(config-router)#network 10.1.2.0 0.0.0.3 area 0
R1(config-router)#network 10.1.3.0 0.0.0.3 area 0
R1(config-router)#network 192.168.1.0 0.0.0.255 area 1
```

4. Убедитесь, что на маршрутизаторе R1 работает протокол маршрутизации OSPF и с его помощью объявлены все напрямую подключенный сети в соответствующих зонах при помощи команды **show ip protocols**.

```
R1# show ip protocols
…
Routing Protocol is "ospf 100"
…
  Number of areas in this router is 2.
  Routing for Networks:
    10.1.2.0 0.0.0.3 area 0
    10.1.3.0 0.0.0.3 area 0
    192.168.1.0 0.0.0.255 area 1
```

5. Аналогично на маршрутизаторе R2 создайте процесс OSPF с идентификатором процесса 100 и включите OSPF на интерфейсах G0/0 – зона 2, G0/1 и G0/2 – магистральная зона.
6. Убедитесь, что на маршрутизаторе R2 все интерфейсы принадлежат соответствующей зоне при помощи команды **show ip ospf interface brief**.

```
R2(config)#router ospf 100
R2(config-router)#network 192.168.2.0 0.0.0.255 area 2
R2(config-router)#network 10.1.2.0 0.0.0.3 area 0
R2(config-router)#network 10.2.3.0 0.0.0.3 area 0

R2#show ip ospf interface brief 
Interface    PID   Area            IP Address/Mask    Cost  State Nbrs F/C
Gi0/2        100   0               10.2.3.1/30        1     DR    1/1
Gi0/1        100   0               10.1.2.2/30        1     BDR   1/1
Gi0/0        100   2               192.168.2.2/24     1     DR    0/0
```

7. Затем и на маршрутизаторе R3 создайте процесс OSPF с идентификатором процесса 100 и включите OSPF на интерфейсах G0/0 – зона 3, G0/1 и G0/2 – магистральная зона.
8. Убедитесь, что маршрутизатор R3 установил соседство с другими маршрутизаторами при помощи команды **show ip eigrp neighbors**.
9. Просмотрите таблицу маршрутизации на маршрутизаторе R3 и убедитесь, в корректном получений маршрутов при помощи команды **show ip route ospf**.

```
R3(config)#router ospf 100
R3(config-router)#network 192.168.3.0 0.0.0.255 area 3
R3(config-router)#network 10.1.3.0 0.0.0.3 area 0
R3(config-router)#network 10.2.3.0 0.0.0.3 area 0

R3#sh ip ospf neighbor 
Neighbor ID     Pri   State           Dead Time   Address         Interface
192.168.2.2       1   FULL/DR         00:00:36    10.2.3.1        GigabitEthernet0/2
192.168.1.1       1   FULL/DR         00:00:35    10.1.3.1        GigabitEthernet0/1

R3# show ip route ospf
Codes: O - OSPF, IA - OSPF inter area 

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
O        10.1.2.0/30 [110/2] via 10.2.3.1, 00:37:55, GigabitEthernet0/2
                     [110/2] via 10.1.3.1, 00:38:18, GigabitEthernet0/1
O IA  192.168.1.0/24 [110/2] via 10.1.3.1, 00:38:18, GigabitEthernet0/1
O IA  192.168.2.0/24 [110/2] via 10.2.3.1, 00:37:55, GigabitEthernet0/2
```

**Примечание** 

---

Маршруты intraarea (код O) относятся к обновлениям, которые передаются в пределах одной зоны. Interarea (код IA) маршруты относятся к обновлениям, которые передаются между несколькими зонами.

---

1. На всех клиентских машинах выполните проверку доступности друг друга при помощи команды **ping**.

```
PC-A:~$ ping -c 2 192.168.2.11
PING 192.168.2.11 (192.168.2.11): 56 data bytes
64 bytes from 192.168.2.11: seq=0 ttl=42 time=23.935 ms
64 bytes from 192.168.2.11: seq=1 ttl=42 time=8.662 ms
--- 192.168.2.11 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss

PC-A:~$ ping -c 2 192.168.3.11
PING 192.168.3.11 (192.168.3.11): 56 data bytes
64 bytes from 192.168.3.11: seq=0 ttl=42 time=21.397 ms
64 bytes from 192.168.3.11: seq=1 ttl=42 time=12.733 ms
--- 192.168.3.11 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss

PC-B:~$ ping -c 2 192.168.3.11
PING 192.168.3.11 (192.168.3.11): 56 data bytes
64 bytes from 192.168.3.11: seq=0 ttl=42 time=11.007 ms
64 bytes from 192.168.3.11: seq=1 ttl=42 time=7.187 ms
--- 192.168.3.11 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
```
