## Лабораторная работа 4.6. Создание виртуальной машины с помощью интерфейса командной строки

### Описание сценария

Инструмент командной строки AzureCLI разработан специально для автоматизации операций по работе с инфраструктурой MicrosoftAzure. Данный инструмент реализует все программные методы взаимодействия с интерфейсом облака Azure и может использоваться как альтернатива сценариям на языке PowerShell.

В данном сценарии системный администратор создает сценарий автоматизированного развертывания виртуальной машины с использованием AzureCLI.

### Задачи лабораторной работы

- Настроить оболочку CloudShell
- Создать виртуальную машину с помощью сценария AzureCLI
- Изучить команды AzureCLI для управления состояния виртуальных машин

### Настройка Cloud Shell  на портале  Azure

1. Войдите на портал Azure по адресу **portal.azure.com** под вашей учетной записью.
2. Создайте группу ресурсов или используйте группу ресурсов, выделенную для вашей учетной записи.
3. В верхней панели портала нажмите на значок терминала (справа от строки поиска), после чего в нижней части страницы откроется раздел терминала **Azure Cloud Shell** , где будет предложено выбрать **Bash** или **PowerShell**. Выберите **Bash**.
4. Появится сообщение о том, что у вас не подключено хранилище. Выберите «**Показать дополнительные настройки**» и введите следующие параметры:

| **Параметр** | **Значение** |
| --- | --- |
| Подписка | Использовать предоставленное по умолчанию |
| Группа ресурсов | Использовать предоставленное по умолчанию |
| Учетная запись хранения (создать новую) | cloudshellxxxxx (замените **xxxxx** таким образом, чтобы имя учетной записи было уникальным) |
| Регион Cloud Shell | Восточная часть США |
| Общая папка (создать новую) | shellstorage |

### Создание виртуальной машины с помощью AZ CLI

1. После запуска Cloud Shell убедитесь в том, что в левом верхнем углу терминала выбрана опция Bash.
2. Просмотрите информацию о доступных вам группах ресурсов с помощью команды **az group list --output table**. В отображенной таблице вы должны увидеть вашу группу ресурсов.
3. Запустите создание виртуальной машины, с помощью следующей команды в терминале:

```
az vm create \
--name myVMCLI \
--resource-group имя-вашей-группы-ресурсов \
--image UbuntuLTS \
--location EastUS \
--admin-username azureuser \
--admin-password Pa$$w0rd1234
--size Standard_D2s_v3
```

Обратите внимание, что в конце каждой строки используется обратный слеш (\\) для переноса команды на следующую строку, альтернативно вся команда может быть написана в одну строку.

### Управление состоянием виртуальной машины с помощью AZ CLI

1. Для получения текущего статуса виртуальной машины выполните в терминале команду **az vm show --resource-group имя-вашей-группы-ресурсов --name myVMCLI --show-details --output table**.
2. Для остановки виртуальной машины используйте команду **az vm stop --resource-group  имя-вашей-группы-ресурсов --name myVMCLI**. Подождите до отображения состояния успешного выполнения.
3. Выполните команду о просмотре состояния еще раз, убедитесь в том, что отображается статус о том, что виртуальная машина остановлена.
4. Справка по всем командам AZCLI может быть вызвана командой **az --help**.
